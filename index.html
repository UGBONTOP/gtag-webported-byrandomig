<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes">
    <title>Unity WebGL Player | GTAGWebport</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #231F20;
      }
      
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      
      #unity-container {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      #unity-canvas {
        width: 100%;
        height: 100%;
        background: #231F20;
        display: block;
      }
      
      /* Loading Screen */
      #loading-screen {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #231F20;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        transition: opacity 0.5s ease-out;
      }
      
      #loading-screen.fade-out {
        opacity: 0;
        pointer-events: none;
      }
      
      .loading-content {
        text-align: center;
        color: white;
        font-family: Arial, sans-serif;
      }
      
      .loading-title {
        font-size: 32px;
        margin-bottom: 30px;
        font-weight: bold;
      }
      
      .loading-bar-container {
        width: 300px;
        height: 20px;
        background: #333;
        border-radius: 10px;
        overflow: hidden;
        margin-bottom: 15px;
        border: 2px solid #555;
      }
      
      .loading-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #4CAF50, #8BC34A);
        transition: width 0.3s ease;
        border-radius: 8px;
      }
      
      .loading-text {
        font-size: 16px;
        color: #aaa;
        margin-top: 10px;
      }
      
      .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #333;
        border-top-color: #4CAF50;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 20px auto;
      }
      
      @keyframes spin {
        to { transform: rotate(360deg); }
      }
      
      /* Fullscreen Button */
      #fullscreen-button {
        position: absolute;
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
        background: rgba(0, 0, 0, 0.7);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        transition: all 0.3s ease;
      }
      
      #fullscreen-button:hover {
        background: rgba(0, 0, 0, 0.9);
        border-color: rgba(255, 255, 255, 0.6);
        transform: scale(1.1);
      }
      
      #fullscreen-button svg {
        width: 24px;
        height: 24px;
        fill: white;
      }
      
      /* Hide fullscreen button when in fullscreen */
      :-webkit-full-screen #fullscreen-button,
      :-moz-full-screen #fullscreen-button,
      :fullscreen #fullscreen-button {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="unity-container">
      <canvas id="unity-canvas"></canvas>
      
      <!-- Loading Screen -->
      <div id="loading-screen">
        <div class="loading-content">
          <div class="loading-title">GTAGWebport</div>
          <div class="loading-bar-container">
            <div class="loading-bar" id="loading-bar"></div>
          </div>
          <div class="loading-text" id="loading-text">Loading... 0%</div>
          <div class="loading-spinner"></div>
        </div>
      </div>
      
      <!-- Fullscreen Button -->
      <button id="fullscreen-button" title="Fullscreen (F11)">
        <svg viewBox="0 0 24 24">
          <path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
        </svg>
      </button>
    </div>

    <!-- Firebase for voice chat room coordination -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script>
      firebase.initializeApp({
        databaseURL: "https://gorillatag-vc-default-rtdb.firebaseio.com"
      });
    </script>
    
    <script src="Build/Build.loader.js"></script>
    <script>
      var unityInstance = null;
      var loadingScreen = document.getElementById('loading-screen');
      var loadingBar = document.getElementById('loading-bar');
      var loadingText = document.getElementById('loading-text');
      var canvas = document.getElementById('unity-canvas');
      var fullscreenButton = document.getElementById('fullscreen-button');
      
      // Update loading progress
      function updateLoadingProgress(progress) {
        var percent = Math.round(progress * 100);
        loadingBar.style.width = percent + '%';
        loadingText.textContent = 'Loading... ' + percent + '%';
        
        if (percent < 30) {
          loadingText.textContent = 'Loading chunks... ' + percent + '%';
        } else if (percent < 60) {
          loadingText.textContent = 'Loading framework... ' + percent + '%';
        } else if (percent < 90) {
          loadingText.textContent = 'Initializing... ' + percent + '%';
        } else if (percent < 100) {
          loadingText.textContent = 'Almost ready... ' + percent + '%';
        } else {
          loadingText.textContent = 'Starting game...';
        }
      }
      
      // Hide loading screen
      function hideLoadingScreen() {
        loadingScreen.classList.add('fade-out');
        setTimeout(function() {
          loadingScreen.style.display = 'none';
        }, 500);
      }
      
      // Fullscreen functionality
      function toggleFullscreen() {
        var container = document.getElementById('unity-container');
        
        if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement) {
          if (container.requestFullscreen) {
            container.requestFullscreen();
          } else if (container.webkitRequestFullscreen) {
            container.webkitRequestFullscreen();
          } else if (container.mozRequestFullScreen) {
            container.mozRequestFullScreen();
          }
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
          } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
          }
        }
      }
      
      fullscreenButton.addEventListener('click', toggleFullscreen);
      
      document.addEventListener('keydown', function(e) {
        if (e.key === 'F11') {
          e.preventDefault();
          toggleFullscreen();
        }
      });
      
      createUnityInstance(canvas, {
        dataUrl: "Build/Build.data",
        frameworkUrl: "Build/Build.framework.js",
        codeUrl: "Build/Build.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "CrunchArcade",
        productName: "GTAGWebport",
        productVersion: "1",
      }, function(progress) {
        updateLoadingProgress(progress);
      }).then(function(instance) {
        unityInstance = instance;
        hideLoadingScreen();
        console.log('Unity game loaded successfully!');
      }).catch(function(message) {
        loadingText.textContent = 'Error loading game: ' + message;
        loadingText.style.color = '#ff4444';
        console.error('Unity load error:', message);
      });
    </script>
  </body>
</html>